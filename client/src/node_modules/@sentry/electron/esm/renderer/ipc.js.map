{"version":3,"file":"ipc.js","sourceRoot":"","sources":["../../src/renderer/ipc.ts"],"names":[],"mappings":"AAAA,0CAA0C;AAC1C,+BAA+B;AAC/B,OAAO,EAAE,MAAM,EAAE,MAAM,eAAe,CAAC;AAEvC,OAAO,EAAE,UAAU,EAAgB,eAAe,EAAE,MAAM,WAAW,CAAC;AAEtE,4CAA4C;AAC5C,SAAS,iBAAiB;IACxB,sDAAsD;IACtD,IAAI,MAAM,CAAC,cAAc,EAAE;QACzB,OAAO,MAAM,CAAC,cAAc,CAAC;KAC9B;IAED,MAAM,CAAC,GAAG,CAAC,qFAAqF,CAAC,CAAC;IAElG,KAAK,CAAC,GAAG,eAAe,MAAM,UAAU,CAAC,IAAI,EAAE,CAAC,CAAC,KAAK,CAAC,GAAG,EAAE,CAC1D,OAAO,CAAC,KAAK,CAAC;;;0HAGwG,CAAC,CACxH,CAAC;IAEF,6EAA6E;IAC7E,qJAAqJ;IACrJ,OAAO;QACL,SAAS,EAAE,CAAC,KAAK,EAAE,EAAE;YACnB,KAAK,CAAC,GAAG,eAAe,MAAM,UAAU,CAAC,KAAK,aAAa,EAAE,EAAE,MAAM,EAAE,MAAM,EAAE,IAAI,EAAE,KAAK,EAAE,CAAC,CAAC,KAAK,CAAC,GAAG,EAAE;gBACvG,SAAS;YACX,CAAC,CAAC,CAAC;QACL,CAAC;QACD,SAAS,EAAE,CAAC,KAAK,EAAE,EAAE;YACnB,KAAK,CAAC,GAAG,eAAe,MAAM,UAAU,CAAC,KAAK,aAAa,EAAE,EAAE,MAAM,EAAE,MAAM,EAAE,IAAI,EAAE,KAAK,EAAE,CAAC,CAAC,KAAK,CAAC,GAAG,EAAE;gBACvG,SAAS;YACX,CAAC,CAAC,CAAC;QACL,CAAC;KACF,CAAC;AACJ,CAAC;AAED,IAAI,eAAyC,CAAC;AAE9C;;;;;GAKG;AACH,MAAM,UAAU,MAAM;IACpB,IAAI,CAAC,eAAe,EAAE;QACpB,eAAe,GAAG,iBAAiB,EAAE,CAAC;KACvC;IAED,OAAO,eAAe,CAAC;AACzB,CAAC","sourcesContent":["/* eslint-disable no-restricted-globals */\n/* eslint-disable no-console */\nimport { logger } from '@sentry/utils';\n\nimport { IPCChannel, IPCInterface, PROTOCOL_SCHEME } from '../common';\n\n/** Gets the available IPC implementation */\nfunction getImplementation(): IPCInterface {\n  // Favour IPC if it's been exposed by a preload script\n  if (window.__SENTRY_IPC__) {\n    return window.__SENTRY_IPC__;\n  }\n\n  logger.log('IPC was not configured in preload script, falling back to custom protocol and fetch');\n\n  fetch(`${PROTOCOL_SCHEME}://${IPCChannel.PING}`).catch(() =>\n    console.error(`Sentry SDK failed to establish connection with the Electron main process.\n - Ensure you have initialized the SDK in the main process\n - If your renderers use custom sessions, be sure to set 'getSessions' in the main process options\n - If you are bundling your main process code and using Electron < v5, you'll need to manually configure a preload script`),\n  );\n\n  // We include sentry_key in the URL so these dont end up in fetch breadcrumbs\n  // https://github.com/getsentry/sentry-javascript/blob/a3f70d8869121183bec037571a3ee78efaf26b0b/packages/browser/src/integrations/breadcrumbs.ts#L240\n  return {\n    sendScope: (scope) => {\n      fetch(`${PROTOCOL_SCHEME}://${IPCChannel.SCOPE}/sentry_key`, { method: 'POST', body: scope }).catch(() => {\n        // ignore\n      });\n    },\n    sendEvent: (event) => {\n      fetch(`${PROTOCOL_SCHEME}://${IPCChannel.EVENT}/sentry_key`, { method: 'POST', body: event }).catch(() => {\n        // ignore\n      });\n    },\n  };\n}\n\nlet cachedInterface: IPCInterface | undefined;\n\n/**\n * Renderer IPC interface\n *\n * Favours IPC if its been exposed via a preload script but will\n * fallback to custom protocol and fetch is IPC is not available\n */\nexport function getIPC(): IPCInterface {\n  if (!cachedInterface) {\n    cachedInterface = getImplementation();\n  }\n\n  return cachedInterface;\n}\n"]}